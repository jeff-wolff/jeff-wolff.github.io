/* http://keith-wood.name/countdown.html
   Countdown for jQuery v1.5.11.
   Written by Keith Wood (kbwood{at}iinet.com.au) January 2008.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses.
   Please attribute the author if you use it. */
(function(c){function d(){this.regional=[];this.regional[""]={labels:["Years","Months","Weeks","Days","Hours","Minutes","Seconds"],labels1:["Year","Month","Week","Day","Hour","Minute","Second"],compactLabels:["y","m","w","d"],whichLabels:null,timeSeparator:":",isRTL:false};this._defaults={until:null,since:null,timezone:null,serverSync:null,format:"dHMS",layout:"",compact:false,significant:0,description:"",expiryUrl:"",expiryText:"",alwaysExpire:false,onExpiry:null,onTick:null,tickInterval:1};c.extend(this._defaults,this.regional[""]);this._serverSyncs=[];function m(p){var o=(p||new Date().getTime());if(o-n>=1000){c.countdown._updateTargets();n=o}l(m)}var l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null;var n=0;if(!l){setInterval(function(){c.countdown._updateTargets()},980)}else{n=window.mozAnimationStartTime||new Date().getTime();l(m)}}var i="countdown";var j=0;var k=1;var g=2;var f=3;var a=4;var b=5;var e=6;c.extend(d.prototype,{markerClassName:"hasCountdown",_timerTargets:[],setDefaults:function(l){this._resetExtraLabels(this._defaults,l);h(this._defaults,l||{})},UTCDate:function(p,r,l,t,q,s,m,n){if(typeof r=="object"&&r.constructor==Date){n=r.getMilliseconds();m=r.getSeconds();s=r.getMinutes();q=r.getHours();t=r.getDate();l=r.getMonth();r=r.getFullYear()}var o=new Date();o.setUTCFullYear(r);o.setUTCDate(1);o.setUTCMonth(l||0);o.setUTCDate(t||1);o.setUTCHours(q||0);o.setUTCMinutes((s||0)-(Math.abs(p)<30?p*60:p));o.setUTCSeconds(m||0);o.setUTCMilliseconds(n||0);return o},periodsToSeconds:function(l){return l[0]*31557600+l[1]*2629800+l[2]*604800+l[3]*86400+l[4]*3600+l[5]*60+l[6]},_settingsCountdown:function(n,l){if(!l){return c.countdown._defaults}var m=c.data(n,i);return(l=="all"?m.options:m.options[l])},_attachCountdown:function(l,o){var n=c(l);if(n.hasClass(this.markerClassName)){return}n.addClass(this.markerClassName);var m={options:c.extend({},o),_periods:[0,0,0,0,0,0,0]};c.data(l,i,m);this._changeCountdown(l)},_addTarget:function(l){if(!this._hasTarget(l)){this._timerTargets.push(l)}},_hasTarget:function(l){return(c.inArray(l,this._timerTargets)>-1)},_removeTarget:function(l){this._timerTargets=c.map(this._timerTargets,function(m){return(m==l?null:m)})},_updateTargets:function(){for(var l=this._timerTargets.length-1;l>=0;l--){this._updateCountdown(this._timerTargets[l])}},_updateCountdown:function(v,t){var o=c(v);t=t||c.data(v,i);if(!t){return}o.html(this._generateHTML(t));o[(this._get(t,"isRTL")?"add":"remove")+"Class"]("countdown_rtl");var m=this._get(t,"onTick");if(m){var u=t._hold!="lap"?t._periods:this._calculatePeriods(t,t._show,this._get(t,"significant"),new Date());var l=this._get(t,"tickInterval");if(l==1||this.periodsToSeconds(u)%l==0){m.apply(v,[u])}}var r=t._hold!="pause"&&(t._since?t._now.getTime()<t._since.getTime():t._now.getTime()>=t._until.getTime());if(r&&!t._expiring){t._expiring=true;if(this._hasTarget(v)||this._get(t,"alwaysExpire")){this._removeTarget(v);var q=this._get(t,"onExpiry");if(q){q.apply(v,[])}var p=this._get(t,"expiryText");if(p){var n=this._get(t,"layout");t.options.layout=p;this._updateCountdown(v,t);t.options.layout=n}var s=this._get(t,"expiryUrl");if(s){window.location=s}}t._expiring=false}else{if(t._hold=="pause"){this._removeTarget(v)}}c.data(v,i,t)},_changeCountdown:function(q,m,n){m=m||{};if(typeof m=="string"){var l=m;m={};m[l]=n}var o=c.data(q,i);if(o){this._resetExtraLabels(o.options,m);h(o.options,m);this._adjustSettings(q,o);c.data(q,i,o);var p=new Date();if((o._since&&o._since<p)||(o._until&&o._until>p)){this._addTarget(q)}this._updateCountdown(q,o)}},_resetExtraLabels:function(o,p){var m=false;for(var l in p){if(l!="whichLabels"&&l.match(/[Ll]abels/)){m=true;break}}if(m){for(var l in o){if(l.match(/[Ll]abels[0-9]/)){o[l]=null}}}},_adjustSettings:function(l,r){var s;var m=this._get(r,"serverSync");var t=0;var p=null;for(var q=0;q<this._serverSyncs.length;q++){if(this._serverSyncs[q][0]==m){p=this._serverSyncs[q][1];break}}if(p!=null){t=(m?p:0);s=new Date()}else{var n=(m?m.apply(l,[]):null);s=new Date();t=(n?s.getTime()-n.getTime():0);this._serverSyncs.push([m,t])}var o=this._get(r,"timezone");o=(o==null?-s.getTimezoneOffset():o);r._since=this._get(r,"since");if(r._since!=null){r._since=this.UTCDate(o,this._determineTime(r._since,null));if(r._since&&t){r._since.setMilliseconds(r._since.getMilliseconds()+t)}}r._until=this.UTCDate(o,this._determineTime(this._get(r,"until"),s));if(t){r._until.setMilliseconds(r._until.getMilliseconds()+t)}r._show=this._determineShow(r)},_destroyCountdown:function(l){var m=c(l);if(!m.hasClass(this.markerClassName)){return}this._removeTarget(l);m.removeClass(this.markerClassName).empty();c.removeData(l,i)},_pauseCountdown:function(l){this._hold(l,"pause")},_lapCountdown:function(l){this._hold(l,"lap")},_resumeCountdown:function(l){this._hold(l,null)},_hold:function(m,l){var n=c.data(m,i);if(n){if(n._hold=="pause"&&!l){n._periods=n._savePeriods;var o=(n._since?"-":"+");n[n._since?"_since":"_until"]=this._determineTime(o+n._periods[0]+"y"+o+n._periods[1]+"o"+o+n._periods[2]+"w"+o+n._periods[3]+"d"+o+n._periods[4]+"h"+o+n._periods[5]+"m"+o+n._periods[6]+"s");this._addTarget(m)}n._hold=l;n._savePeriods=(l=="pause"?n._periods:null);c.data(m,i,n);this._updateCountdown(m,n)}},_getTimesCountdown:function(l){var m=c.data(l,i);return(!m?null:(!m._hold?m._periods:this._calculatePeriods(m,m._show,this._get(m,"significant"),new Date())))},_get:function(m,l){return(m.options[l]!=null?m.options[l]:c.countdown._defaults[l])},_determineTime:function(m,l){var o=function(q){var r=new Date();r.setTime(r.getTime()+q*1000);return r};var p=function(s){s=s.toLowerCase();var q=new Date();var x=q.getFullYear();var u=q.getMonth();var z=q.getDate();var r=q.getHours();var w=q.getMinutes();var y=q.getSeconds();var v=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g;var t=v.exec(s);while(t){switch(t[2]||"s"){case"s":y+=parseInt(t[1],10);break;case"m":w+=parseInt(t[1],10);break;case"h":r+=parseInt(t[1],10);break;case"d":z+=parseInt(t[1],10);break;case"w":z+=parseInt(t[1],10)*7;break;case"o":u+=parseInt(t[1],10);z=Math.min(z,c.countdown._getDaysInMonth(x,u));break;case"y":x+=parseInt(t[1],10);z=Math.min(z,c.countdown._getDaysInMonth(x,u));break}t=v.exec(s)}return new Date(x,u,z,r,w,y,0)};var n=(m==null?l:(typeof m=="string"?p(m):(typeof m=="number"?o(m):m)));if(n){n.setMilliseconds(0)}return n},_getDaysInMonth:function(m,l){return 32-new Date(m,l,32).getDate()},_normalLabels:function(l){return l},_generateHTML:function(t){var r=this._get(t,"significant");t._periods=(t._hold?t._periods:this._calculatePeriods(t,t._show,r,new Date()));var m=false;var l=0;var x=r;var z=c.extend({},t._show);for(var v=j;v<=e;v++){m|=(t._show[v]=="?"&&t._periods[v]>0);z[v]=(t._show[v]=="?"&&!m?null:t._show[v]);l+=(z[v]?1:0);x-=(t._periods[v]>0?1:0)}var w=[false,false,false,false,false,false,false];for(var v=e;v>=j;v--){if(t._show[v]){if(t._periods[v]){w[v]=true}else{w[v]=x>0;x--}}}var n=this._get(t,"compact");var o=this._get(t,"layout");var p=(n?this._get(t,"compactLabels"):this._get(t,"labels"));var u=this._get(t,"whichLabels")||this._normalLabels;var A=this._get(t,"timeSeparator");var q=this._get(t,"description")||"";var s=function(C){var B=c.countdown._get(t,"compactLabels"+u(t._periods[C]));return(z[C]?t._periods[C]+(B?B[C]:p[C])+" ":"")};var y=function(C){var B=c.countdown._get(t,"labels"+u(t._periods[C]));return((!r&&z[C])||(r&&w[C])?'<span class="countdown_section"><span class="countdown_amount">'+t._periods[C]+"</span><br/>"+(B?B[C]:p[C])+"</span>":"")};return(o?this._buildLayout(t,z,o,n,r,w):((n?'<span class="countdown_row countdown_amount'+(t._hold?" countdown_holding":"")+'">'+s(j)+s(k)+s(g)+s(f)+(z[a]?this._minDigits(t._periods[a],2):"")+(z[b]?(z[a]?A:"")+this._minDigits(t._periods[b],2):"")+(z[e]?(z[a]||z[b]?A:"")+this._minDigits(t._periods[e],2):""):'<span class="countdown_row countdown_show'+(r||l)+(t._hold?" countdown_holding":"")+'">'+y(j)+y(k)+y(g)+y(f)+y(a)+y(b)+y(e))+"</span>"+(q?'<span class="countdown_row countdown_descr">'+q+"</span>":"")))},_buildLayout:function(s,z,p,l,o,x){var n=this._get(s,(l?"compactLabels":"labels"));var t=this._get(s,"whichLabels")||this._normalLabels;var w=function(A){return(c.countdown._get(s,(l?"compactLabels":"labels")+t(s._periods[A]))||n)[A]};var m=function(B,A){return Math.floor(B/A)%10};var q={desc:this._get(s,"description"),sep:this._get(s,"timeSeparator"),yl:w(j),yn:s._periods[j],ynn:this._minDigits(s._periods[j],2),ynnn:this._minDigits(s._periods[j],3),y1:m(s._periods[j],1),y10:m(s._periods[j],10),y100:m(s._periods[j],100),y1000:m(s._periods[j],1000),ol:w(k),on:s._periods[k],onn:this._minDigits(s._periods[k],2),onnn:this._minDigits(s._periods[k],3),o1:m(s._periods[k],1),o10:m(s._periods[k],10),o100:m(s._periods[k],100),o1000:m(s._periods[k],1000),wl:w(g),wn:s._periods[g],wnn:this._minDigits(s._periods[g],2),wnnn:this._minDigits(s._periods[g],3),w1:m(s._periods[g],1),w10:m(s._periods[g],10),w100:m(s._periods[g],100),w1000:m(s._periods[g],1000),dl:w(f),dn:s._periods[f],dnn:this._minDigits(s._periods[f],2),dnnn:this._minDigits(s._periods[f],3),d1:m(s._periods[f],1),d10:m(s._periods[f],10),d100:m(s._periods[f],100),d1000:m(s._periods[f],1000),hl:w(a),hn:s._periods[a],hnn:this._minDigits(s._periods[a],2),hnnn:this._minDigits(s._periods[a],3),h1:m(s._periods[a],1),h10:m(s._periods[a],10),h100:m(s._periods[a],100),h1000:m(s._periods[a],1000),ml:w(b),mn:s._periods[b],mnn:this._minDigits(s._periods[b],2),mnnn:this._minDigits(s._periods[b],3),m1:m(s._periods[b],1),m10:m(s._periods[b],10),m100:m(s._periods[b],100),m1000:m(s._periods[b],1000),sl:w(e),sn:s._periods[e],snn:this._minDigits(s._periods[e],2),snnn:this._minDigits(s._periods[e],3),s1:m(s._periods[e],1),s10:m(s._periods[e],10),s100:m(s._periods[e],100),s1000:m(s._periods[e],1000)};var u=p;for(var y=j;y<=e;y++){var v="yowdhms".charAt(y);var r=new RegExp("\\{"+v+"<\\}(.*)\\{"+v+">\\}","g");u=u.replace(r,((!o&&z[y])||(o&&x[y])?"$1":""))}c.each(q,function(C,B){var A=new RegExp("\\{"+C+"\\}","g");u=u.replace(A,B)});return u},_minDigits:function(m,l){m=""+m;if(m.length>=l){return m}m="0000000000"+m;return m.substr(m.length-l)},_determineShow:function(l){var n=this._get(l,"format");var m=[];m[j]=(n.match("y")?"?":(n.match("Y")?"!":null));m[k]=(n.match("o")?"?":(n.match("O")?"!":null));m[g]=(n.match("w")?"?":(n.match("W")?"!":null));m[f]=(n.match("d")?"?":(n.match("D")?"!":null));m[a]=(n.match("h")?"?":(n.match("H")?"!":null));m[b]=(n.match("m")?"?":(n.match("M")?"!":null));m[e]=(n.match("s")?"?":(n.match("S")?"!":null));return m},_calculatePeriods:function(s,B,p,l){s._now=l;s._now.setMilliseconds(0);var y=new Date(s._now.getTime());if(s._since){if(l.getTime()<s._since.getTime()){s._now=l=y}else{l=s._since}}else{y.setTime(s._until.getTime());if(l.getTime()>s._until.getTime()){s._now=l=y}}var D=[0,0,0,0,0,0,0];if(B[j]||B[k]){var A=c.countdown._getDaysInMonth(l.getFullYear(),l.getMonth());var m=c.countdown._getDaysInMonth(y.getFullYear(),y.getMonth());var u=(y.getDate()==l.getDate()||(y.getDate()>=Math.min(A,m)&&l.getDate()>=Math.min(A,m)));var r=function(E){return(E.getHours()*60+E.getMinutes())*60+E.getSeconds()};var C=Math.max(0,(y.getFullYear()-l.getFullYear())*12+y.getMonth()-l.getMonth()+((y.getDate()<l.getDate()&&!u)||(u&&r(y)<r(l))?-1:0));D[j]=(B[j]?Math.floor(C/12):0);D[k]=(B[k]?C-D[j]*12:0);l=new Date(l.getTime());var o=(l.getDate()==A);var t=c.countdown._getDaysInMonth(l.getFullYear()+D[j],l.getMonth()+D[k]);if(l.getDate()>t){l.setDate(t)}l.setFullYear(l.getFullYear()+D[j]);l.setMonth(l.getMonth()+D[k]);if(o){l.setDate(t)}}var z=Math.floor((y.getTime()-l.getTime())/1000);var w=function(E,F){D[E]=(B[E]?Math.floor(z/F):0);z-=D[E]*F};w(g,604800);w(f,86400);w(a,3600);w(b,60);w(e,1);if(z>0&&!s._since){var x=[1,12,4.3482,7,24,60,60];var n=e;var q=1;for(var v=e;v>=j;v--){if(B[v]){if(D[n]>=q){D[n]=0;z=1}if(z>0){D[v]++;z=0;n=v;q=1}}q*=x[v]}}if(p){for(var v=j;v<=e;v++){if(p&&D[v]){p--}else{if(!p){D[v]=0}}}}return D}});function h(m,n){c.extend(m,n);for(var l in n){if(n[l]==null){m[l]=null}}return m}c.fn.countdown=function(m){var l=Array.prototype.slice.call(arguments,1);if(m=="getTimes"||m=="settings"){return c.countdown["_"+m+"Countdown"].apply(c.countdown,[this[0]].concat(l))}return this.each(function(){if(typeof m=="string"){c.countdown["_"+m+"Countdown"].apply(c.countdown,[this].concat(l))}else{c.countdown._attachCountdown(this,m)}})};c.countdown=new d()})(jQuery);