<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SDK playground - oEmbed</title>
    <script src="https://connect.soundcloud.com/sdk/sdk-3.0.0.js" type="text/javascript"></script>
    <script src="https://w.soundcloud.com/player/api.js" type="text/javascript"></script>
  </head>
  <body>

    <a href="#" id="login"><img src="http://connect.soundcloud.com/2/btn-connect-sc-l.png" alt=""></a>
    <div id="result"><iframe src="" frameborder="0"></iframe></div>

	<script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"></script>
    <script type="text/javascript">
    SC.initialize({
      client_id: '5afcef3388a0bd8047f1ab79a58d3faa',
      redirect_uri: 'http://jeffwolff.net/sndcld/callback.html'
    });

    // initiate auth popup
    $("#login").on("click", function( event ) {
    	var song_list = [];
    	event.preventDefault();
	    SC.connect().then(function() {
	      return SC.get('/me/activities', { limit: 210 });
	    }).then(function(me) {
	    	// console.log(Object.keys(me.collection));
	    	for (var i = me.collection.length - 1; i >= 0; i--) {
        		if (me.collection[i].type === "track") {
	      			song_list.push(me.collection[i].stream_url);
          		}
	      	}
	      	for (i in song_list) {
	      		console.log(Object.keys(song_list[i].origin) + '\n');
	      	}

	      	for (var i = 0; i <= song_list.length - 1; i++) {
	      		$('#result').append(iframe);
	      		$.getJSON( 
	      		    'http://soundcloud.com/oembed.json?url=' + song_list[i]
	      		  ).done( function ( data ) {
	      		    var widget;
	      		    $('#result').html( data.html );
	      		    widget = SC.Widget($('#result').find('iframe')[i]);
	      		    widget.bind('ready', function () {
	      		      // widget.play();
	      		    });
	      		});
	      	}
	      	var first = $('#result').find('iframe')[0];
	      	first.bind('ready', function () {
	      	  first.play();
	      	});


	    });
	});

	
    </script>

  </body>
</html>